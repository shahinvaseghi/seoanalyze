<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sitemap Analyzer</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:#07111f;color:#e7eaf3;margin:0}
    header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;background:#0d1830;border-bottom:1px solid #1f2a44}
    .brand{font-weight:700}
    .container{padding:24px;max-width:1200px;margin:0 auto}
    a{color:#93c5fd;text-decoration:none}
    .input-group{margin:20px 0}
    .input-group label{display:block;margin-bottom:8px;font-weight:500;color:#93c5fd}
    .input-group input{width:100%;max-width:600px;padding:10px;border:1px solid #1f2a44;border-radius:6px;background:#0d1830;color:#e7eaf3;font-size:14px}
    .btn{background:#10b981;color:#fff;border:none;border-radius:6px;padding:12px 24px;cursor:pointer;font-size:14px;font-weight:600}
    .btn:hover{background:#059669}
    .section{background:#0d1830;border:1px solid #1f2a44;border-radius:8px;padding:20px;margin:16px 0}
    .section h3{color:#93c5fd;margin-top:0}
    .loading{text-align:center;padding:40px;color:#a0aec0}
    .error{background:#ef4444;color:white;padding:16px;border-radius:8px;margin:16px 0}
  </style>
</head>
<body>
  <header>
    <div class="brand">SEO Tools</div>
    <nav>
      <a href="/dashboard">Dashboard</a> &nbsp; | &nbsp;
      <a href="/logout">Logout</a>
    </nav>
  </header>
  <div class="container">
    <h1>üó∫Ô∏è Sitemap Analyzer</h1>
    <p style="color:#a0aec0">Analyze and validate XML sitemaps</p>
    
    <div class="input-group">
      <label for="url">Website URL:</label>
      <input id="url" type="text" placeholder="https://example.com" />
    </div>
    <div class="input-group">
      <label for="sitemapUrl">Sitemap URL (Optional - leave empty to auto-detect):</label>
      <input id="sitemapUrl" type="text" placeholder="https://example.com/sitemap.xml" />
    </div>
    
    <button class="btn" onclick="analyze()">Analyze Sitemap</button>
    <div id="results"></div>
  </div>
  <script>
    function analyze() {
      const url = document.getElementById('url').value.trim();
      const sitemapUrl = document.getElementById('sitemapUrl').value.trim();
      const results = document.getElementById('results');
      const btn = document.querySelector('.btn');
      
      if (!url) { 
        results.innerHTML = '<div class="error">Enter URL</div>'; 
        return; 
      }
      
      btn.disabled = true;
      btn.textContent = 'Analyzing...';
      results.innerHTML = '<div class="loading">Analyzing sitemap...</div>';
      
      fetch('/sitemap-analyzer/api/analyze', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({url, sitemap_url: sitemapUrl || null})
      })
      .then(r => r.json())
      .then(d => {
        btn.disabled = false;
        btn.textContent = 'Analyze Sitemap';
        
        if (d.error) { 
          results.innerHTML = `<div class="error">${d.error}${d.traceback ? '<br><pre style="font-size:11px;overflow:auto">' + d.traceback + '</pre>' : ''}</div>`; 
          return; 
        }
        
        let html = '';
        
        // Summary
        html += `<div class="section">
          <h3>üìä Sitemap Analysis</h3>
          <p><strong>Sitemaps Found:</strong> ${d.sitemaps_found}</p>
          <p><strong>Total URLs:</strong> ${d.total_urls.toLocaleString()}</p>
          ${d.timestamp ? `<p style="color:#a0aec0;font-size:12px">Analyzed at: ${new Date(d.timestamp).toLocaleString()}</p>` : ''}
        </div>`;
        
        // Sitemaps list
        if (d.sitemaps && d.sitemaps.length > 0) {
          html += `<div class="section">
            <h3>üó∫Ô∏è Found Sitemaps</h3>
            <ul style="list-style:none;padding:0">`;
          d.sitemaps.forEach((sitemap, idx) => {
            html += `<li style="padding:8px 0;border-bottom:1px solid #1f2a44">
              <strong>${idx + 1}.</strong> 
              <a href="${sitemap.url}" target="_blank" style="color:#60a5fa">${sitemap.url}</a>
              <span style="color:#a0aec0;font-size:12px;margin-left:8px">(${sitemap.type || 'unknown'}, ${sitemap.total || 0} URLs)</span>
            </li>`;
          });
          html += `</ul></div>`;
        }
        
        // Issues
        if (d.issues && d.issues.length > 0) {
          html += `<div class="section">
            <h3>‚ö†Ô∏è Issues</h3>
            <ul style="list-style:none;padding:0">`;
          d.issues.forEach(issue => {
            html += `<li style="padding:8px 0;border-bottom:1px solid #1f2a44;color:#f59e0b">‚ö†Ô∏è ${issue}</li>`;
          });
          html += `</ul></div>`;
        }
        
        // Errors
        if (d.errors && d.errors.length > 0) {
          html += `<div class="section">
            <h3>‚ùå Errors</h3>
            <ul style="list-style:none;padding:0">`;
          d.errors.forEach(error => {
            html += `<li style="padding:8px 0;border-bottom:1px solid #1f2a44;color:#ef4444">‚ùå ${error}</li>`;
          });
          html += `</ul></div>`;
        }
        
        // URLs list (limited)
        if (d.urls && d.urls.length > 0) {
          html += `<div class="section">
            <h3>üîó URLs (showing first ${d.urls.length} of ${d.total_urls.toLocaleString()})</h3>
            <div style="max-height:400px;overflow-y:auto">
              <table style="width:100%;border-collapse:collapse;font-size:13px">
                <thead>
                  <tr style="border-bottom:2px solid #1f2a44">
                    <th style="text-align:left;padding:8px">URL</th>
                    <th style="text-align:left;padding:8px">Last Modified</th>
                    <th style="text-align:left;padding:8px">Priority</th>
                  </tr>
                </thead>
                <tbody>`;
          d.urls.forEach((urlItem, idx) => {
            html += `<tr style="border-bottom:1px solid #1f2a44">
              <td style="padding:8px">
                <a href="${urlItem.url}" target="_blank" style="color:#60a5fa;word-break:break-all">${urlItem.url}</a>
              </td>
              <td style="padding:8px;color:#a0aec0">${urlItem.lastmod || 'N/A'}</td>
              <td style="padding:8px;color:#a0aec0">${urlItem.priority || 'N/A'}</td>
            </tr>`;
          });
          html += `</tbody></table></div></div>`;
        }
        
        if (!html) {
          html = '<div class="section"><h3>No Results</h3><p>No sitemap data found.</p></div>';
        }
        
        results.innerHTML = html;
      })
      .catch(e => {
        btn.disabled = false;
        btn.textContent = 'Analyze Sitemap';
        results.innerHTML = `<div class="error">Error: ${e.message}</div>`;
      });
    }
  </script>
</body>
</html>

