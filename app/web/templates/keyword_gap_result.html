<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keyword Gap Analysis Results</title>
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      background: #0b1220;
      color: #e7eaf3;
      margin: 0;
      line-height: 1.6;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      background: #0d1830;
      border-bottom: 1px solid #1f2a44;
    }
    
    .container {
      padding: 24px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1, h2, h3 {
      color: #e7eaf3;
      margin-top: 0;
    }
    
    .section {
      background: #111a2b;
      border: 1px solid #1f2a44;
      border-radius: 10px;
      padding: 24px;
      margin: 16px 0;
    }
    
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 16px 0;
    }
    
    .summary-card {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 16px;
      text-align: center;
    }
    
    .summary-card h3 {
      margin: 0 0 8px;
      color: #4f46e5;
    }
    
    .summary-card .number {
      font-size: 2em;
      font-weight: bold;
      color: #e7eaf3;
    }
    
    .keyword-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 12px;
      margin: 16px 0;
    }
    
    .keyword-card {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 12px;
      transition: border-color 0.2s;
    }
    
    .keyword-card:hover {
      border-color: #4f46e5;
    }
    
    .keyword-card .keyword {
      font-weight: bold;
      color: #4f46e5;
      margin-bottom: 4px;
    }
    
    .keyword-card .source {
      font-size: 0.8em;
      color: #a9b3c7;
      margin-bottom: 4px;
    }
    
    .keyword-card .context {
      font-size: 0.9em;
      color: #e7eaf3;
      font-style: italic;
    }
    
    .difficulty-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: bold;
      margin-left: 8px;
    }
    
    .difficulty-easy {
      background: #10b981;
      color: white;
    }
    
    .difficulty-medium {
      background: #f59e0b;
      color: white;
    }
    
    .difficulty-hard {
      background: #ef4444;
      color: white;
    }
    
    .recommendation {
      background: #1e293b;
      border-left: 4px solid #4f46e5;
      padding: 16px;
      margin: 12px 0;
      border-radius: 0 8px 8px 0;
    }
    
    .recommendation h4 {
      margin: 0 0 8px;
      color: #4f46e5;
    }
    
    .recommendation .priority {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: bold;
      margin-left: 8px;
    }
    
    .priority-high {
      background: #ef4444;
      color: white;
    }
    
    .priority-medium {
      background: #f59e0b;
      color: white;
    }
    
    .priority-low {
      background: #10b981;
      color: white;
    }
    
    .collapsible {
      cursor: pointer;
      user-select: none;
    }
    
    .collapsible:hover {
      color: #4f46e5;
    }
    
    .collapsible-content {
      display: none;
      margin-top: 12px;
    }
    
    .collapsible-content.show {
      display: block;
    }
    
    .arrow {
      display: inline-block;
      margin-left: 8px;
      transition: transform 0.2s;
    }
    
    .arrow.rotated {
      transform: rotate(90deg);
    }
    
    nav a {
      color: #93c5fd;
      text-decoration: none;
      margin: 0 8px;
    }
    
    nav a:hover {
      color: #dbeafe;
    }
    
    .btn {
      display: inline-block;
      padding: 8px 16px;
      background: #4f46e5;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      margin: 8px 8px 8px 0;
      transition: background 0.2s;
    }
    
    .btn:hover {
      background: #4338ca;
    }
    
    .btn.secondary {
      background: #334155;
    }
    
    .btn.secondary:hover {
      background: #475569;
    }
    
    .metadata {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }
    
    .metadata h4 {
      margin: 0 0 12px;
      color: #e7eaf3;
    }
    
    .metadata-item {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      border-bottom: 1px solid #334155;
    }
    
    .metadata-item:last-child {
      border-bottom: none;
    }
    
    .metadata-label {
      color: #a9b3c7;
    }
    
    .metadata-value {
      color: #e7eaf3;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <header>
    <div>Keyword Gap Analysis Results</div>
    <nav>
      <a href="/dashboard">Dashboard</a>
      &nbsp;|&nbsp;
      <a href="/keyword-gap/">New Analysis</a>
      &nbsp;|&nbsp;
      <a href="/competitors/">Competitors Analysis</a>
      &nbsp;|&nbsp;
      <a href="/logout">Logout</a>
    </nav>
  </header>
  
  <div class="container">
    <h1>Keyword Gap Analysis Results</h1>
    
    <!-- Analysis Summary -->
    <div class="section">
      <h2>Analysis Summary</h2>
      <div class="summary-grid">
        <div class="summary-card">
          <h3>Your Website</h3>
          <div class="number">{{ result.own_keywords|length }}</div>
          <div>Keywords Found</div>
        </div>
        <div class="summary-card">
          <h3>Competitors</h3>
          <div class="number">{{ result.competitors|length }}</div>
          <div>Websites Analyzed</div>
        </div>
        <div class="summary-card">
          <h3>Gap Keywords</h3>
          <div class="number">{{ result.gap_keywords|length }}</div>
          <div>Opportunities Found</div>
        </div>
        <div class="summary-card">
          <h3>Recommendations</h3>
          <div class="number">{{ result.recommendations|length }}</div>
          <div>Action Items</div>
        </div>
      </div>
    </div>
    
    <!-- Analysis Metadata -->
    <div class="metadata">
      <h4>Analysis Details</h4>
      <div class="metadata-item">
        <span class="metadata-label">Your Website:</span>
        <span class="metadata-value">{{ result.own_website }}</span>
      </div>
      <div class="metadata-item">
        <span class="metadata-label">Analysis Date:</span>
        <span class="metadata-value">{{ result.analysis_metadata.analysis_date[:19] }}</span>
      </div>
      <div class="metadata-item">
        <span class="metadata-label">Total Competitor Keywords:</span>
        <span class="metadata-value">{{ result.analysis_metadata.total_competitor_keywords }}</span>
      </div>
      <div class="metadata-item">
        <span class="metadata-label">Results File:</span>
        <span class="metadata-value">{{ filename.split('/')[-1] }}</span>
      </div>
    </div>
    
    <!-- Gap Keywords -->
    <div class="section">
      <h2 class="collapsible" onclick="toggleSection('gap-keywords')">
        Keyword Gaps Found ({{ result.gap_keywords|length if result.gap_keywords else 0 }})
        <span class="arrow" id="gap-keywords-arrow">▼</span>
      </h2>
      <div id="gap-keywords" class="collapsible-content">
        <p>These are keywords that your competitors are targeting but you are not:</p>
        <div class="keyword-list">
          {% if result.gap_keywords and result.gap_keywords|length > 0 %}
            {% for keyword in result.gap_keywords[:20] %}
            <div class="keyword-card">
              <div class="keyword">
                {{ keyword.keyword if keyword.keyword else 'Unknown' }}
                <span class="difficulty-badge difficulty-{{ keyword.difficulty if keyword.difficulty else 'medium' }}">
                  {{ keyword.difficulty if keyword.difficulty else 'medium' }}
                </span>
              </div>
              <div class="source">Source: {{ keyword.source if keyword.source else 'unknown' }}</div>
              <div class="context">{{ (keyword.context[:100] if keyword.context else 'No context available') }}{% if keyword.context and keyword.context|length > 100 %}...{% endif %}</div>
            </div>
            {% endfor %}
          {% else %}
            <p>No gap keywords found.</p>
          {% endif %}
        </div>
        {% if result.gap_keywords and result.gap_keywords|length > 20 %}
        <p><em>Showing top 20 keywords. Total: {{ result.gap_keywords|length }}</em></p>
        {% endif %}
      </div>
    </div>
    
    <!-- Recommendations -->
    <div class="section">
      <h2 class="collapsible" onclick="toggleSection('recommendations')">
        Recommendations ({{ result.recommendations|length }})
        <span class="arrow" id="recommendations-arrow">▼</span>
      </h2>
      <div id="recommendations" class="collapsible-content">
        {% if result.recommendations %}
          {% for rec in result.recommendations %}
          <div class="recommendation">
            <h4>
              {{ rec.title }}
              <span class="priority priority-{{ rec.priority }}">{{ rec.priority }}</span>
            </h4>
            <p>{{ rec.description }}</p>
            <p><strong>Action:</strong> {{ rec.action }}</p>
            {% if rec.keywords %}
            <div class="keyword-list">
              {% for keyword in rec.keywords[:10] %}
              <div class="keyword-card">
                <div class="keyword">
                  {{ keyword.keyword }}
                  <span class="difficulty-badge difficulty-{{ keyword.difficulty }}">
                    {{ keyword.difficulty }}
                  </span>
                </div>
                <div class="source">Source: {{ keyword.source }}</div>
              </div>
              {% endfor %}
            </div>
            {% endif %}
          </div>
          {% endfor %}
        {% else %}
          <p>No recommendations available.</p>
        {% endif %}
      </div>
    </div>
    
    <!-- Your Keywords -->
    <div class="section">
      <h2 class="collapsible" onclick="toggleSection('own-keywords')">
        Your Current Keywords ({{ result.own_keywords|length }})
        <span class="arrow" id="own-keywords-arrow">▼</span>
      </h2>
      <div id="own-keywords" class="collapsible-content">
        <div class="keyword-list">
          {% if result.own_keywords %}
            {% for key, keyword in result.own_keywords.items() %}
            <div class="keyword-card">
              <div class="keyword">
                {{ keyword.keyword }}
                <span class="difficulty-badge difficulty-{{ keyword.difficulty }}">
                  {{ keyword.difficulty }}
                </span>
              </div>
              <div class="source">Source: {{ keyword.source }} | Frequency: {{ keyword.frequency }}</div>
              <div class="context">{{ keyword.context[:100] }}{% if keyword.context|length > 100 %}...{% endif %}</div>
            </div>
            {% endfor %}
          {% else %}
            <p>No keywords found for your website.</p>
          {% endif %}
        </div>
      </div>
    </div>
    
    <!-- Competitor Keywords -->
    <div class="section">
      <h2 class="collapsible" onclick="toggleSection('competitor-keywords')">
        Competitor Keywords
        <span class="arrow" id="competitor-keywords-arrow">▼</span>
      </h2>
      <div id="competitor-keywords" class="collapsible-content">
        {% for competitor, keywords in result.competitor_keywords.items() %}
        <h3 class="collapsible" onclick="toggleSection('competitor-{{ loop.index }}')">
          {{ competitor }} ({{ keywords|length }} keywords)
          <span class="arrow" id="competitor-{{ loop.index }}-arrow">▼</span>
        </h3>
        <div id="competitor-{{ loop.index }}" class="collapsible-content">
          <div class="keyword-list">
            {% for key, keyword in keywords.items() %}
            <div class="keyword-card">
              <div class="keyword">
                {{ keyword.keyword }}
                <span class="difficulty-badge difficulty-{{ keyword.difficulty }}">
                  {{ keyword.difficulty }}
                </span>
              </div>
              <div class="source">Source: {{ keyword.source }} | Frequency: {{ keyword.frequency }}</div>
              <div class="context">{{ keyword.context[:100] }}{% if keyword.context|length > 100 %}...{% endif %}</div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    
    <!-- Actions -->
    <div class="section">
      <h2>Next Steps</h2>
      <a href="/keyword-gap/" class="btn">New Analysis</a>
      <a href="/dashboard" class="btn secondary">Back to Dashboard</a>
      <a href="/competitors/" class="btn secondary">Competitors Analysis</a>
    </div>
  </div>

  <script>
    function toggleSection(sectionId) {
      const content = document.getElementById(sectionId);
      const arrow = document.getElementById(sectionId + '-arrow');
      
      if (!content || !arrow) {
        console.error('Element not found:', sectionId);
        return;
      }
      
      if (content.classList.contains('show')) {
        content.classList.remove('show');
        arrow.classList.remove('rotated');
      } else {
        content.classList.add('show');
        arrow.classList.add('rotated');
      }
    }
    
    // Auto-expand gap keywords section
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, expanding gap keywords section');
      toggleSection('gap-keywords');
    });
  </script>
</body>
</html>
