<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keyword Gap Analysis Results</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0b1220;
      color: #e7eaf3;
      margin: 0;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1, h2 {
      color: #e7eaf3;
    }
    
    .section {
      background: #111a2b;
      border: 1px solid #1f2a44;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .summary-card {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }
    
    .summary-card h3 {
      margin: 0 0 10px;
      color: #4f46e5;
    }
    
    .summary-card .number {
      font-size: 2em;
      font-weight: bold;
      color: #e7eaf3;
    }
    
    .keyword-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    
    .keyword-card {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 15px;
    }
    
    .keyword-card .keyword {
      font-weight: bold;
      color: #4f46e5;
      margin-bottom: 5px;
    }
    
    .keyword-card .source {
      font-size: 0.9em;
      color: #a9b3c7;
      margin-bottom: 5px;
    }
    
    .keyword-card .context {
      font-size: 0.9em;
      color: #e7eaf3;
      font-style: italic;
    }
    
    .difficulty-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: bold;
      margin-left: 8px;
    }
    
    .difficulty-easy {
      background: #10b981;
      color: white;
    }
    
    .difficulty-medium {
      background: #f59e0b;
      color: white;
    }
    
    .difficulty-hard {
      background: #ef4444;
      color: white;
    }
    
    .collapsible {
      cursor: pointer;
      user-select: none;
    }
    
    .collapsible:hover {
      color: #4f46e5;
    }
    
    .collapsible-content {
      display: none;
      margin-top: 15px;
    }
    
    .collapsible-content.show {
      display: block;
    }
    
    .arrow {
      display: inline-block;
      margin-left: 8px;
      transition: transform 0.2s;
    }
    
    .arrow.rotated {
      transform: rotate(90deg);
    }
    
    nav a {
      color: #93c5fd;
      text-decoration: none;
      margin: 0 8px;
    }
    
    nav a:hover {
      color: #dbeafe;
    }
    
    .btn {
      display: inline-block;
      padding: 10px 20px;
      background: #4f46e5;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      margin: 10px 10px 10px 0;
      transition: background 0.2s;
    }
    
    .btn:hover {
      background: #4338ca;
    }
    
    .btn.secondary {
      background: #334155;
    }
    
    .btn.secondary:hover {
      background: #475569;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Keyword Gap Analysis Results</h1>
      <nav>
        <a href="/dashboard">Dashboard</a>
        <a href="/keyword-gap/">New Analysis</a>
        <a href="/competitors/">Competitors Analysis</a>
        <a href="/logout">Logout</a>
      </nav>
    </header>
    
    <!-- Analysis Summary -->
    <div class="section">
      <h2>Analysis Summary</h2>
      <div class="summary">
        <div class="summary-card">
          <h3>Your Website</h3>
          <div class="number">{{ result.own_keywords|length if result.own_keywords else 0 }}</div>
          <div>Keywords Found</div>
        </div>
        <div class="summary-card">
          <h3>Competitors</h3>
          <div class="number">{{ result.competitors|length if result.competitors else 0 }}</div>
          <div>Websites Analyzed</div>
        </div>
        <div class="summary-card">
          <h3>Gap Keywords</h3>
          <div class="number">{{ result.gap_keywords|length if result.gap_keywords else 0 }}</div>
          <div>Opportunities Found</div>
        </div>
        <div class="summary-card">
          <h3>Recommendations</h3>
          <div class="number">{{ result.recommendations|length if result.recommendations else 0 }}</div>
          <div>Action Items</div>
        </div>
      </div>
    </div>
    
    <!-- Analysis Details -->
    <div class="section">
      <h2>Analysis Details</h2>
      <p><strong>Your Website:</strong> {{ result.own_website if result.own_website else 'Unknown' }}</p>
      <p><strong>Analysis Date:</strong> {{ result.analysis_metadata.analysis_date[:19] if result.analysis_metadata and result.analysis_metadata.analysis_date else 'Unknown' }}</p>
      <p><strong>Total Competitor Keywords:</strong> {{ result.analysis_metadata.total_competitor_keywords if result.analysis_metadata and result.analysis_metadata.total_competitor_keywords else 0 }}</p>
      <p><strong>Results File:</strong> {{ filename.split('/')[-1] if filename else 'Unknown' }}</p>
    </div>
    
    <!-- Gap Keywords -->
    <div class="section">
      <h2 class="collapsible" onclick="toggleSection('gap-keywords')">
        Keyword Gaps Found ({{ result.gap_keywords|length if result.gap_keywords else 0 }})
        <span class="arrow" id="gap-keywords-arrow">▼</span>
      </h2>
      <div id="gap-keywords" class="collapsible-content show">
        <p>These are keywords that your competitors are targeting but you are not:</p>
        <div class="keyword-list">
          {% if result.gap_keywords and result.gap_keywords|length > 0 %}
            {% for keyword in result.gap_keywords[:20] %}
            <div class="keyword-card">
              <div class="keyword">
                {{ keyword.keyword if keyword.keyword else 'Unknown' }}
                <span class="difficulty-badge difficulty-{{ keyword.difficulty if keyword.difficulty else 'medium' }}">
                  {{ keyword.difficulty if keyword.difficulty else 'medium' }}
                </span>
              </div>
              <div class="source">Source: {{ keyword.source if keyword.source else 'unknown' }}</div>
              <div class="context">{{ (keyword.context[:100] if keyword.context else 'No context available') }}{% if keyword.context and keyword.context|length > 100 %}...{% endif %}</div>
            </div>
            {% endfor %}
          {% else %}
            <p>No gap keywords found.</p>
          {% endif %}
        </div>
        {% if result.gap_keywords and result.gap_keywords|length > 20 %}
        <p><em>Showing top 20 keywords. Total: {{ result.gap_keywords|length }}</em></p>
        {% endif %}
      </div>
    </div>
    
    <!-- Recommendations -->
    <div class="section">
      <h2 class="collapsible" onclick="toggleSection('recommendations')">
        Recommendations ({{ result.recommendations|length if result.recommendations else 0 }})
        <span class="arrow" id="recommendations-arrow">▼</span>
      </h2>
      <div id="recommendations" class="collapsible-content show">
        {% if result.recommendations and result.recommendations|length > 0 %}
          {% for rec in result.recommendations %}
          <div style="background: #1e293b; border-left: 4px solid #4f46e5; padding: 15px; margin: 15px 0; border-radius: 0 8px 8px 0;">
            <h4 style="margin: 0 0 10px; color: #4f46e5;">
              {{ rec.title if rec.title else 'Recommendation' }}
              <span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; font-weight: bold; margin-left: 8px; background: #ef4444; color: white;">
                {{ rec.priority if rec.priority else 'high' }}
              </span>
            </h4>
            <p>{{ rec.description if rec.description else 'No description available.' }}</p>
            <p><strong>Action:</strong> {{ rec.action if rec.action else 'No action specified.' }}</p>
          </div>
          {% endfor %}
        {% else %}
          <p>No recommendations available.</p>
        {% endif %}
      </div>
    </div>
    
    <!-- Your Keywords -->
    <div class="section">
      <h2 class="collapsible" onclick="toggleSection('own-keywords')">
        Your Current Keywords ({{ result.own_keywords|length if result.own_keywords else 0 }})
        <span class="arrow" id="own-keywords-arrow">▼</span>
      </h2>
      <div id="own-keywords" class="collapsible-content">
        <div class="keyword-list">
          {% if result.own_keywords and result.own_keywords|length > 0 %}
            {% for key, keyword in result.own_keywords.items() %}
            <div class="keyword-card">
              <div class="keyword">
                {{ keyword.keyword if keyword.keyword else 'Unknown' }}
                <span class="difficulty-badge difficulty-{{ keyword.difficulty if keyword.difficulty else 'medium' }}">
                  {{ keyword.difficulty if keyword.difficulty else 'medium' }}
                </span>
              </div>
              <div class="source">Source: {{ keyword.source if keyword.source else 'unknown' }} | Frequency: {{ keyword.frequency if keyword.frequency else 0 }}</div>
              <div class="context">{{ (keyword.context[:100] if keyword.context else 'No context available') }}{% if keyword.context and keyword.context|length > 100 %}...{% endif %}</div>
            </div>
            {% endfor %}
          {% else %}
            <p>No keywords found for your website.</p>
          {% endif %}
        </div>
      </div>
    </div>
    
    <!-- Competitor Keywords -->
    <div class="section">
      <h2 class="collapsible" onclick="toggleSection('competitor-keywords')">
        Competitor Keywords ({{ result.competitor_keywords|length if result.competitor_keywords else 0 }})
        <span class="arrow" id="competitor-keywords-arrow">▼</span>
      </h2>
      <div id="competitor-keywords" class="collapsible-content">
        <div class="keyword-list">
          {% if result.competitor_keywords and result.competitor_keywords|length > 0 %}
            {% for key, keyword in result.competitor_keywords.items() %}
            <div class="keyword-card">
              <div class="keyword">
                {{ keyword.keyword if keyword.keyword else 'Unknown' }}
                <span class="difficulty-badge difficulty-{{ keyword.difficulty if keyword.difficulty else 'medium' }}">
                  {{ keyword.difficulty if keyword.difficulty else 'medium' }}
                </span>
              </div>
              <div class="source">Source: {{ keyword.source if keyword.source else 'unknown' }} | Frequency: {{ keyword.frequency if keyword.frequency else 0 }}</div>
              <div class="context">{{ (keyword.context[:100] if keyword.context else 'No context available') }}{% if keyword.context and keyword.context|length > 100 %}...{% endif %}</div>
            </div>
            {% endfor %}
          {% else %}
            <p>No competitor keywords found.</p>
          {% endif %}
        </div>
      </div>
    </div>
    
    <!-- Actions -->
    <div class="section">
      <h2>Next Steps</h2>
      <a href="/keyword-gap/" class="btn">New Analysis</a>
      <a href="/dashboard" class="btn secondary">Back to Dashboard</a>
      <a href="/competitors/" class="btn secondary">Competitors Analysis</a>
    </div>
  </div>

  <script>
    function toggleSection(sectionId) {
      const content = document.getElementById(sectionId);
      const arrow = document.getElementById(sectionId + '-arrow');
      
      if (!content || !arrow) {
        console.error('Element not found:', sectionId);
        return;
      }
      
      if (content.classList.contains('show')) {
        content.classList.remove('show');
        arrow.classList.remove('rotated');
      } else {
        content.classList.add('show');
        arrow.classList.add('rotated');
      }
    }
    
    // Auto-expand gap keywords and recommendations sections
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, expanding sections');
      // Set arrows to rotated state for expanded sections
      document.getElementById('gap-keywords-arrow').classList.add('rotated');
      document.getElementById('recommendations-arrow').classList.add('rotated');
    });
  </script>
</body>
</html>
